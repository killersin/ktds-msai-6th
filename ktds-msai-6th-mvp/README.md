# ğŸ“˜ RAG ê¸°ë°˜ ì»´í”Œë¼ì´ì–¸ìŠ¤ ì±—ë´‡
âœ¨ ì´ ë¬¸ì„œëŠ” ë¡œì»¬ ê°œë°œ ë° PoC(Proof of Concept) ë°°í¬ë¥¼ ìœ„í•œ READMEì…ë‹ˆë‹¤.

ğŸ¯ í”„ë¡œì íŠ¸ ê°œìš”
---------------
RAG(Retrieval-Augmented Generation) ê¸°ë°˜ìœ¼ë¡œ KTë‚´ ì»´í”Œë¼ì´ì–¸ìŠ¤ ê´€ë ¨ ë¬¸ì„œ ë° ìµœì‹  ë‰´ìŠ¤Â·ì‚¬ë¡€ë¥¼ ê²€ìƒ‰Â·ìš”ì•½í•˜ì—¬
ì§ì› ì§ˆë¬¸ì— ì‹¤ì‹œê°„ìœ¼ë¡œ ì‘ë‹µí•˜ê³ , ìš”ì•½ ê²°ê³¼ë¥¼ ìŠ¬ë™ìœ¼ë¡œ ìë™ ì „ì†¡í•˜ëŠ” AI ì–´ì‹œìŠ¤í„´íŠ¸ì…ë‹ˆë‹¤.

> **ì»´í”Œë¼ì´ì–¸ìŠ¤**: ê¸°ì—… ë‚´ ìœ¤ë¦¬ì Â·ë²•ì Â·ì¬ë¬´ì  ë¦¬ìŠ¤í¬ë¥¼ ì‚¬ì „ì— ë°©ì§€í•˜ê³  ê·œì •ì„ ì¤€ìˆ˜í•˜ë„ë¡ ì§€ì›í•˜ëŠ” í™œë™

âš ï¸ ë¬¸ì œ ì •ì˜
----------------------
1. ë‚´ë¶€ ê·œì •ì´ ë°©ëŒ€í•˜ê³  ë³µì¡í•˜ì—¬ ì§ì›ì´ í•„ìš”í•œ ì •ë³´ë¥¼ ì¦‰ì‹œ ì°¾ê¸° ì–´ë ¤ì›€
2. ì»´í”Œë¼ì´ì–¸ìŠ¤ ê´€ë ¨ ìµœì‹  ë™í–¥ ë° ì‚¬ë¡€ ì¸ì‹ ë¶€ì¡±

   â†’ ì¸ì‹ ì œê³  í•„ìš”

âœ… í•´ê²° ë°©ì•ˆ
-----------
1) RAG ê¸°ë°˜ ê²€ìƒ‰Â·ì‘ë‹µ
 - Azure AI Searchë¡œ ê´€ë ¨ ë¬¸ì„œë¥¼ ê²€ìƒ‰í•˜ê³ , ê²€ìƒ‰ ê²°ê³¼ë¥¼ ì»¨í…ìŠ¤íŠ¸ë¡œ Azure OpenAI(GPT-4.1-mini)ì— ì „ë‹¬í•˜ì—¬
      ì •í™•í•˜ê³  ê·¼ê±° ìˆëŠ” ì‘ë‹µì„ ì œê³µí•©ë‹ˆë‹¤.

2) ë‰´ìŠ¤ ìš”ì•½ ë° ì•Œë¦¼
 - ì‚¬ë‚´ ê²Œì‹œê¸€ì„ ìˆ˜ì§‘í•˜ì—¬ ìš”ì•½ì„ ìƒì„±í•˜ê³ , ê²°ê³¼ë¥¼ ìŠ¬ë™ìœ¼ë¡œ ì „ì†¡í•˜ì—¬ ì¸ì‹ ì œê³ ì— í™œìš©í•©ë‹ˆë‹¤.

## ğŸ—ï¸ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```plaintext
ì‚¬ìš©ì ì§ˆë¬¸
     â†“
[Streamlit Web UI]
     â†“
[LangChain]
     â†“
1. ì§ˆë¬¸ ì˜ë„ ë¶„ì„ ë° í•„í„°ë§
     â†“
2. RAG íŒŒì´í”„ë¼ì¸ ì²˜ë¦¬
   - Azure AI Search: ê´€ë ¨ ë¬¸ì„œ ê²€ìƒ‰
   - Azure OpenAI GPT-4.1 Mini: ë‹µë³€ ìƒì„±
     â†“
3. ì‘ë‹µ ì¶œë ¥ (Q&A)

+ [ë‰´ìŠ¤ ìš”ì•½ ë° ìŠ¬ë™ ì•Œë¦¼]
 - ê²Œì‹œíŒ í¬ë¡¤ë§
 - ë‰´ìŠ¤ ìš”ì•½ ì²˜ë¦¬ (GPT)
 - ìŠ¬ë™ ì±„ë„ ìë™ ì „ì†¡
```
ğŸ§° ì£¼ìš” ê¸°ìˆ  ìŠ¤íƒ 
----------------
- í”„ë ˆì„ì›Œí¬: LangChain
- ì›¹ UI: Streamlit
- í”„ë¡œê·¸ë˜ë° ì–¸ì–´: Python 3.11
- í´ë¼ìš°ë“œ: Microsoft Azure (AI Search, OpenAI, App Service, Blob Storage)

ğŸ’¬ RAG ê²€ìƒ‰ ì‹œë‚˜ë¦¬ì˜¤ ì˜ˆì‹œ 
-----------------------
- "ì„ì§ì› ë³´ì•ˆìˆ˜ì¤€ì§„ë‹¨ì‚¬ì´íŠ¸ ì£¼ì†Œ ì•Œë ¤ì¤˜" â†’ ê´€ë ¨ ë¬¸ì„œ ë‚´ ë§í¬/ì°¸ê³  ì œê³µ
- "KTê°€ ê·œì •í•œ ì‚°ì—…ì•ˆì „ë³´ê±´ ì•Œë ¤ì¤˜" â†’ ì‚¬ë‚´ ê·œì •ì„ ì •ë¦¬
- "ì ì‹¬ë©”ë‰´ ì¶”ì²œ" â†’ ì—…ë¬´ ë²”ìœ„ë¥¼ ë²—ì–´ë‚œ ìš”ì²­ì€ ê±°ë¶€ ë° ê°€ì´ë“œ ì•ˆë‚´

```
ğŸ“ í”„ë¡œì íŠ¸ ì‹¤ì œ íŒŒì¼ êµ¬ì¡° (ì´ ì €ì¥ì†Œì˜ `ktds-msai-6th-mvp` í´ë” ê¸°ì¤€) 
---------------------------------------------

.deployment                 # ë°°í¬ ê´€ë ¨(ì˜µì…˜)
.env                       # í™˜ê²½ë³€ìˆ˜ (ê°œì¸/ë¹„ê³µê°œ - Git ì œì™¸)
app.py                     # Streamlit ì•± ì—”íŠ¸ë¦¬ í¬ì¸íŠ¸
streamlit.sh               # ë°°í¬/ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸(App Serviceìš©)
assets/                    # ì •ì  ìì›(ì¶”ê°€ ê°€ëŠ¥í•œ ë‹¤ì´ì–´ê·¸ë¨ ë“±)
data/
     â”œâ”€ board_data.json       # ê²Œì‹œê¸€(ë‰´ìŠ¤) ì˜ˆì‹œ ë°ì´í„°
     â”œâ”€ 9_field.json          # ì»´í”Œë¼ì´ì–¸ìŠ¤ ì¹´í…Œê³ ë¦¬ ìƒ˜í”Œ
     â””â”€ uploads/              # ì—…ë¡œë“œëœ íŒŒì¼ ì„ì‹œ ì €ì¥ì†Œ
modules/
     â”œâ”€ appinsight.py         # App Insights ì´ˆê¸°í™” ë° ë¡œê¹…
     â”œâ”€ azure_ai_search.py    # Azure Search í´ë¼ì´ì–¸íŠ¸ ë° ì¸ë±ì‹± ìœ í‹¸
     â””â”€ newssummary.py        # ê²Œì‹œíŒ ëª©ë¡/ìƒì„¸, ìš”ì•½ ë° ìŠ¬ë™ ì „ì†¡
```

## ğŸ“ˆ Azure ëª¨ë‹ˆí„°ë§
Application Insights ë° Azure Monitorë¥¼ ì‚¬ìš©í•´ ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒíƒœ(ì‹œì‘/ì¢…ë£Œ)ì™€ ë¡œê·¸/íŠ¸ë ˆì´ìŠ¤ë¥¼ ìˆ˜ì§‘í•˜ê³ , Kusto ì¿¼ë¦¬ì™€ ê²½ê³ (Alert)ë¥¼ í†µí•´ ìš´ì˜ ì•Œë¦¼ì„ êµ¬ì„±í•˜ëŠ” ê°„ë‹¨í•œ ê°€ì´ë“œì…ë‹ˆë‹¤.
Application Insightsë¥¼ í†µí•´ ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒíƒœ(ì‹œì‘/ì¢…ë£Œ)ë¥¼ ìˆ˜ì§‘í•˜ë„ë¡ êµ¬ì„±

ì•„ë˜ ë‚´ìš©ì€ ì €ì¥ì†Œì˜ ì†ŒìŠ¤(`modules/appinsight.py`, `app.py`)ë¥¼ ì°¸ê³ í•œ ëª¨ë‹ˆí„°ë§ ë° ì•Œë¦¼ ì„¤ì • ê°€ì´ë“œì…ë‹ˆë‹¤.

1) êµ¬ì„± ìš”ì•½
- ì½”ë“œ ìœ„ì¹˜: `modules/appinsight.py` (Application Insights ì´ˆê¸°í™” í•¨ìˆ˜ `init_appinsights` í¬í•¨)
- ì•± ì‹œì‘/ì¢…ë£Œ ì´ë²¤íŠ¸: `app.py`ì—ì„œ `app_start`(ì•± ì‹œì‘ ì‹œ)ì™€ `app_stop`(ì¢…ë£Œ ì‹œ)ë¥¼ ì „ì†¡í•©ë‹ˆë‹¤.
- í•„ìš” í™˜ê²½ë³€ìˆ˜: `APPLICATIONINSIGHTS_CONNECTION_STRING` (App Serviceì˜ Application settings ë˜ëŠ” ë¡œì»¬ `.env`ì— ì„¤ì •)
- ë°°í¬ ì‹œ ì˜ë¬´: ë°°í¬ í™˜ê²½(ì˜ˆ: App Service)ì— opencensus ê´€ë ¨ íŒ¨í‚¤ì§€ë“¤ì´ ì„¤ì¹˜ë˜ì–´ ìˆì–´ì•¼ ì›ê²©ìœ¼ë¡œ ë¡œê·¸/íŠ¸ë ˆì´ìŠ¤ ì „ì†¡ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. (`streamlit.sh` / `requirements.txt`ë¥¼ í™•ì¸)

2) ë™ì‘ ì›ë¦¬(ê°„ë‹¨)
- ì•±ì´ ì‹œì‘ë  ë•Œ `app_start` ì´ë²¤íŠ¸ê°€ track_eventë¡œ ì „ì†¡ë©ë‹ˆë‹¤.
- í”„ë¡œì„¸ìŠ¤ê°€ SIGTERM ë˜ëŠ” SIGINTë¥¼ ë°›ìœ¼ë©´ `app_stop` ì´ë²¤íŠ¸ë¥¼ ì „ì†¡í•˜ê³  ë¡œê·¸ í•¸ë“¤ëŸ¬ì˜ `flush()`ë¥¼ í˜¸ì¶œí•´ ê°€ëŠ¥í•œ í•œ ì¦‰ì‹œ ì „ì†¡ì„ ì‹œë„í•©ë‹ˆë‹¤.
- Application InsightsëŠ” ì „ì†¡ëœ ë¡œê·¸/íŠ¸ë ˆì´ìŠ¤/ì´ë²¤íŠ¸ë¥¼ ìˆ˜ì§‘í•˜ê³  Azure Portalì˜ Logs(ë˜ëŠ” Live Metrics)ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

3) Kusto(Logs) ì˜ˆì œ ì¿¼ë¦¬
- ìµœê·¼ ì‹œì‘/ì¢…ë£Œ ì´ë²¤íŠ¸ ì¡°íšŒ (ê°€ì¥ ìµœê·¼ 48ì‹œê°„)

```kusto
traces
| where timestamp > ago(48h)
| where message has "app_start" or message has "app_stop" or customDimensions['ai.cloud.role'] == "ktds-msai-mvp"
| project timestamp, message, customDimensions, severityLevel
| sort by timestamp desc
```

- `app_stop`ë§Œ í•„í„°ë§í•˜ì—¬ ìµœê·¼ ì´ë²¤íŠ¸ë¥¼ í™•ì¸í•  ë•Œ:

```kusto
traces
| where timestamp > ago(30d)
| where message has "app_stop" or customDimensions['EventName'] == "app_stop"
| project timestamp, message, customDimensions
| sort by timestamp desc
```

4) Azure Monitorì—ì„œ ê²½ê³ (Alert) ë§Œë“¤ê¸° (app_stop ê°ì§€)
- í¬í„¸: Azure Monitor â†’ Alerts â†’ + Create â†’ Alert rule
     1. Scope: í•´ë‹¹ Application Insights ë¦¬ì†ŒìŠ¤ ì„ íƒ
     2. Condition: "Custom log search" ì„ íƒ
     3. Custom queryì— ìœ„ì˜ `app_stop` ì¿¼ë¦¬ ì‚¬ìš©
           - ì˜ˆ: ìµœê·¼ 15ë¶„ ê°„ `app_stop`ì´ 1ê±´ ì´ìƒ ë°œìƒí•˜ë©´ íŠ¸ë¦¬ê±°
           - ì•„ë˜ ì˜ˆì‹œëŠ” 15ë¶„ ìœˆë„ìš°ì— ê²°ê³¼ ìˆ˜ê°€ 1 ì´ìƒì´ë©´ ì•Œë¦¼




## í–¥í›„ ê°œì„ ì‚¬í•­
- ë©€í‹°ëª¨ë‹¬ RAG ë„ì…
 í…ìŠ¤íŠ¸, ì´ë¯¸ì§€, ì˜¤ë””ì˜¤ ë“± ì—¬ëŸ¬ ì¢…ë¥˜ì˜ ë°ì´í„°ë¥¼ í†µí•©ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ê³  ê²€ìƒ‰í•˜ëŠ” RAG(Retrieval Augmented Generation) ê¸°ìˆ 
- ì¸ì¦Â·ì¸ê°€(SSO ì—°ë™) ë„ì…
